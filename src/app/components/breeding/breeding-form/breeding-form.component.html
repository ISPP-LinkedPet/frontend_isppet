
<div class="container" *ngIf="breedingForm != undefined">
    <div class="card border-primary mb-3">
    <div class="card-body">
        <h1 class="card-title*n" *ngIf="creating && rol == 'particular'">{{title}} publicacion</h1>
        <h1 class="card-title*n" *ngIf="!creating && rol == 'particular'">Editar publicación</h1>

        <form [formGroup]="breedingForm">

          <em *ngIf="creating" class="text-secondary">Los campos en gris están deshabilitados</em>
            <fieldset>
                <legend class="card-title">Información básica</legend>

                <div class="row">

                  <!-- Breed -->
                <div *ngIf="rol=='particular' && creating">
                  <div class="form-group col-sm" *ngIf="isValidBreed">
                      <label for="age">Raza</label>
                      <input type="text" class="form-control" id="breed" [readOnly]="rol=='particular'" formControlName="breed" (change)="validateBreed()">
                  </div>
                  <div class="form-group has-danger col-sm" *ngIf="!isValidBreed">
                      <label class="form-control-label" for="age">Raza</label>
                      <input type="text" class="form-control is-invalid" id="breed" [readOnly]="rol=='particular'" formControlName="breed" (change)="validateBreed()">
                      <div class="invalid-feedback">Parece que se ha equivocado</div>
                  </div>
                </div>

                <div *ngIf="rol=='particular' && !creating">
                  <div class="form-group col-sm">
                    <label for="age">Raza</label>
                    <input type="text" class="form-control" id="breed" [readOnly]="rol=='particular'" formControlName="breed" (change)="validateBreed()">
                  </div>
                </div>


                  <!-- Genre -->
                <div *ngIf="creating">
                  <div class="form-group col-sm" *ngIf="isValidGenre">
                      <label for="genre">Genero</label>
                      <div *ngIf="rol == 'particular'">
                        <select class="form-control" id="genre" [attr.disabled]="true" formControlName="genre" (change)="validateGenre()">
                            <option value='' [defaultSelected]=true>Seleccione genero</option>
                            <option value='Male'>Macho</option>
                            <option value='Female'>Hembra</option>
                        </select>
                      </div>
                      <div *ngIf="rol=='moderator'">
                        <select class="form-control" id="genre" formControlName="genre" (change)="validateGenre()">
                            <option value='' [defaultSelected]=true>Seleccione genero</option>
                            <option value='Male'>Macho</option>
                            <option value='Female'>Hembra</option>
                        </select>
                      </div>
                  </div>
                  
                  <div class="form-group has-danger col-sm" *ngIf="!isValidGenre">
                      <label class="form-control-label" for="age">Genero</label>
                      <div *ngIf="rol == 'particular'">
                        <select class="form-control is-invalid" id="genre" [attr.disabled]="true" formControlName="genre" (change)="validateGenre()">
                            <option value='' [defaultSelected]=true>Seleccione genero</option>
                            <option value='Male'>Macho</option>
                            <option value='Female'>Hembra</option>
                        </select>
                      </div>

                      <div *ngIf="rol=='moderator'">
                        <select class="form-control is-invalid" id="genre" formControlName="genre" (change)="validateGenre()">
                          <option value='' [defaultSelected]=true>Seleccione genero</option>
                          <option value='Male'>Macho</option>
                          <option value='Female'>Hembra</option>
                        </select>
                      </div>
                      <div class="invalid-feedback">No olvide seleccionar un genero</div>
                  </div>
                </div>

                <div *ngIf="!creating">
                  <div class="form-group col-sm">
                    <label for="genre">Genero</label>
                    <div *ngIf="rol == 'particular'">
                      <select class="form-control" id="genre" [attr.disabled]="true" formControlName="genre" (change)="validateGenre()">
                          <option value='' [defaultSelected]=true>Seleccione genero</option>
                          <option value='Male'>Macho</option>
                          <option value='Female'>Hembra</option>
                      </select>
                    </div>
                    <div *ngIf="rol=='moderator'">
                      <select class="form-control" id="genre" formControlName="genre" (change)="validateGenre()">
                          <option value='' [defaultSelected]=true>Seleccione genero</option>
                          <option value='Male'>Macho</option>
                          <option value='Female'>Hembra</option>
                      </select>
                    </div>
                </div>

                </div>
                  <!-- Age -->
                <div *ngIf="creating">
                  <div class="form-group col-sm" *ngIf="isValidAge">
                      <label for="age">Edad</label>
                      <input type="date" class="form-control" id="age" [readOnly]="rol=='particular'" formControlName="age" (change)="validateAge()">
                  </div>
                  <div class="form-group has-danger col-sm" *ngIf="!isValidAge">
                      <label class="form-control-label" for="age">Edad</label>
                      <input type="date" class="form-control is-invalid" id="age" [readOnly]="rol=='particular'" formControlName="age" (change)="validateAge()">
                      <div class="invalid-feedback">No olvide seleccionar la edad</div>
                  </div>
                </div>

                <div *ngIf="!creating">
                  <div class="form-group col-sm">
                    <label for="age">Edad</label>
                    <input type="date" class="form-control" id="age" [readOnly]="rol=='particular'" formControlName="age" (change)="validateAge()">
                  </div>
                </div>

                </div>

                <div class="row">

                <!-- Animal type -->
                <div *ngIf="creating">
                  <div class="form-group col-sm" *ngIf="isValidType">
                    <label for="type">Tipo animal</label>
                    <div *ngIf="rol=='particular'">
                      <select class="form-control" id="type" [attr.disabled]="true" formControlName="type" (change)="validateType()">
                          <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                          <option value='Dog'>Perro</option>
                          <option value='Cat'>Gato</option>
                          <option value='Horse'>Caballo</option>
                      </select>
                    </div>
                    <div *ngIf="rol=='moderator'">
                      <select class="form-control" id="type" formControlName="type" (change)="validateType()">
                          <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                          <option value='Dog'>Perro</option>
                          <option value='Cat'>Gato</option>
                          <option value='Horse'>Caballo</option>
                      </select>
                    </div>
                  </div>


                  <div class="form-group has-danger col-sm" *ngIf="!isValidType">
                      <label class="form-control-label" for="type">Tipo de animal</label>
                      <div *ngIf="rol=='particular'">
                        <select class="form-control is-invalid" id="type" [attr.disabled]="true" formControlName="type" (change)="validateType()">
                            <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                            <option value='Dog'>Perro</option>
                            <option value='Cat'>Gato</option>
                            <option value='Horse'>Caballo</option>
                        </select>
                    </div>

                      <div *ngIf="rol=='moderator'">
                        <select class="form-control is-invalid" id="type" formControlName="type" (change)="validateType()">
                            <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                            <option value='Dog'>Perro</option>
                            <option value='Cat'>Gato</option>
                            <option value='Horse'>Caballo</option>
                        </select>
                      </div>
                      <div class="invalid-feedback">No olvide seleccionar un tipo</div>
                  </div>
                </div>

                <div *ngIf="!creating">
                  <div class="form-group col-sm" >
                    <label for="type">Tipo animal</label>
                    <div *ngIf="rol=='particular'">
                      <select class="form-control" id="type" [attr.disabled]="true" formControlName="type" (change)="validateType()">
                          <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                          <option value='Dog'>Perro</option>
                          <option value='Cat'>Gato</option>
                          <option value='Horse'>Caballo</option>
                      </select>
                    </div>
                    <div *ngIf="rol=='moderator'">
                      <select class="form-control" id="type" formControlName="type" (change)="validateType()">
                          <option value='' [defaultSelected]=true>Seleccione tipo animal</option>
                          <option value='Dog'>Perro</option>
                          <option value='Cat'>Gato</option>
                          <option value='Horse'>Caballo</option>
                      </select>
                    </div>
                  </div>
                </div>
                  <!-- Precio -->

                  <div class="form-group col-sm" *ngIf="isValidPrice">
                    <label for="age">Precio</label>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text">$</span>
                      </div>
                      <input type="text" class="form-control" [readOnly]="rol=='moderator'" formControlName="price" aria-label="Amount (to the nearest dollar)" (change)="validatePrice()">
                      <div class="input-group-append">
                        <span class="input-group-text">.00</span>
                      </div>
                    </div>
                  </div>

                  <div class="form-group has-danger col-sm" *ngIf="!isValidPrice">
                      <label class="form-control-label" for="age">Precio</label>
                      <div class="input-group mb-3">
                          <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                          </div>
                          <input type="text" class="form-control is-invalid" formControlName="price" aria-label="Amount (to the nearest dollar)" (change)="validatePrice()">
                          <div class="input-group-append">
                              <span class="input-group-text">.00</span>
                          </div>
                          <div class="invalid-feedback">Debe rellenar este campo</div>
                      </div>
                  </div>
                  
                  <!-- Pedigri -->
                <div *ngIf="creating">
                  <div class="form-group col-6" *ngIf="isValidPedigri">
                    <label for="pedigree">Pedigrí</label>
                    <div *ngIf="rol=='particular'">
                      <select class="form-control" id="pedigree" [attr.disabled]="true" formControlName="pedigree">
                        <option value='' [defaultSelected]=true></option>
                        <option value='true'>Si</option>
                        <option value='false'>No</option>
                      </select> 
                    </div>

                    <div *ngIf="rol=='moderator'">
                      <select class="form-control" id="pedigree" formControlName="pedigree">
                        <option value='' [defaultSelected]=true></option>
                        <option value='true'>Si</option>
                        <option value='false'>No</option>
                      </select> 
                    </div>
                  </div>

                  <div class="form-group has-danger col-6" *ngIf="!isValidPedigri">
                      <label class="form-control-label" for="age">Pedigrí</label>
                      <div *ngIf="rol=='particular'">
                        <select class="form-control is-invalid" id="pedigree" [attr.disabled]="true" formControlName="pedigree">
                          <option value='' [defaultSelected]=true>Seleccione un pedigrí</option>
                          <option value='true'>Si</option>
                          <option value='false'>No</option>
                        </select> 
                      </div>

                      <div *ngIf="rol=='moderator'">
                        <select class="form-control is-invalid" id="pedigree" formControlName="pedigree">
                          <option value='' [defaultSelected]=true>Seleccione un pedigrí</option>
                          <option value='true'>Si</option>
                          <option value='false'>No</option>
                        </select> 
                      </div>
                      <div class="invalid-feedback">Debe indicar si es pedigrí</div>
                  </div>
                </div>
                <div *ngIf="!creating"></div>
                  <div class="form-group col-6" >
                  <label for="pedigree">Pedigrí</label>
                  <div *ngIf="rol=='particular'">
                    <select class="form-control" id="pedigree" [attr.disabled]="true" formControlName="pedigree">
                      <option value='' [defaultSelected]=true></option>
                      <option value='true'>Si</option>
                      <option value='false'>No</option>
                    </select> 
                  </div>

                  <div *ngIf="rol=='moderator'">
                    <select class="form-control" id="pedigree" formControlName="pedigree">
                      <option value='' [defaultSelected]=true></option>
                      <option value='true'>Si</option>
                      <option value='false'>No</option>
                    </select> 
                  </div>
                </div>

                </div>

              <div class="row">

                <!-- Animal photo -->
                <div class="form-group col-6" *ngIf="creating && rol != 'moderator'||!creating && rol == 'particular'">
                  <label for="animal_photo">Imagenes</label>
                  <div class="input-group mb-3">
                    <div class="custom-file">
                      <input #animalPhoto type="file" class="custom-file-input" formControlName="animal_photo" name="animal_photo" id="animal_photo" (change)="getAnimalPhotoAndValidate($event)" multiple>
                      <label class="custom-file-label" for="animal_photo">Seleccionar imagenes</label>
                    </div>
                  </div>
                  <div class="invalid-feedback" *ngIf="!isValidAnimalPhoto">Debe subir al menos 2 imágenes del animal</div>
                </div>


                <!-- Location -->
                  <div class="form-group col-sm" *ngIf="isValidLocation">
                      <label for="location">Zona</label>
                      <input type="text" class="form-control" id="location" [readOnly]="rol=='moderator'" formControlName="location" (change)="validateLocation()">
                  </div>
                  <div class="form-group has-danger col-sm" *ngIf="!isValidLocation">
                      <label class="form-control-label" for="age">Zona</label>
                      <input type="text" class="form-control is-invalid" id="location" formControlName="location" (change)="validateLocation()">
                      <div class="invalid-feedback">Debe rellenar este campo</div>
                  </div>
                  <!-- File names -->
                <ul>
                  <li *ngFor="let filename of animalPhotos; let i = index">
                    {{i}} {{filename.name}}
                  </li>
                </ul>
              </div>
            </fieldset>
            <hr>

            <!-- Animal Documentation -->

            <fieldset>
              <legend class="card-title">Documentación de la mascota</legend>

              <div class="row">
                  <!-- Identification photo -->
                <div class="form-group col-6" *ngIf="creating == true && rol != 'moderator'||!creating && rol == 'particular'">
                    <label for="identification_photo">Identificacion de mascota</label>
                    <div class="input-group mb-3">
                      <div class="custom-file">
                        <input #identificationPhoto type="file" class="custom-file-input" formControlName="identification_photo" id="identification_photo" (change)="getIdPhotoAndValidate($event)" multiple>
                        <label class="custom-file-label" for="identification_photo">Seleccionar imagenes</label>
                      </div>
                    </div>
                    <div class="invalid-feedback" *ngIf="!isValidIdentificationPhoto">Debe subir una imagen de la identificación</div>
                </div>

                   <!-- File names -->
                   <ul>
                    <li *ngFor="let filename of identification_photos; let i = index">
                      {{i}} {{filename.name}}
                    </li>
                  </ul>
                  
                <div class="form-group col-4" *ngIf="rol=='moderator' || !creating && rol == 'particular'">
                  <img style="height: 250px; width: 100%; display: block;" src="{{env}}/{{editBreeding.identification_photo.split(',')[0]}}" alt="Card image">
                </div>

              </div>

              <div class="row">

                  <!-- Vaccine passaport -->
                <div class="form-group col-6" *ngIf="creating == true  && rol != 'moderator'">
                    <label for="vaccine_passaport">Cartilla de vacunacion</label>
                    <div class="input-group mb-3">
                      <div class="custom-file">
                        <input #vaccinePassaport type="file" class="custom-file-input" formControlName="vaccine_passaport" id="vaccine_passaport" (change)="getVacPhotoAndValidate($event)" multiple>
                        <label class="custom-file-label" for="vaccine_passaport">Seleccionar imagenes</label>
                      </div>
                    </div>
                    <div class="invalid-feedback"  *ngIf="!isValidVaccinePassaport">Debe subir una imagen de la cartilla de vacunación</div>
                </div>

                
                   <!-- File names -->
                   <ul>
                    <li *ngFor="let filename of vaccine_photos; let i = index">
                      {{i}} {{filename.name}}
                    </li>
                  </ul>

                <div class="form-group col-4" *ngIf="rol=='moderator'||!creating && rol == 'particular'">
                  <img style="height: 150px; width: 100%; display: block;" src="{{env}}/{{editBreeding.vaccine_passport.split(',')[0]}}" alt="Card image">
                </div>
                
              </div>

            </fieldset>
                <button *ngIf="!creating" (click)="onSubmit()" class="btn btn-primary btn-lg button-form">Editar</button>
                <button *ngIf="rol == 'moderator' && creating" (click)="onSubmit()" class="btn btn-primary btn-lg button-form">Acceptar</button>
                <button *ngIf="rol != 'moderator' && creating " (click)="onSubmit()" class="btn btn-primary btn-lg button-form">Crear</button>
                <button *ngIf="rol == 'moderator' && creating" (click)="rejectPublication()" class="btn btn-secondary btn-lg button-form right">Rechazar</button>
            </form>
            <div class="invalid-feedback">{{backError}}</div>
    </div>
    </div>
</div>
